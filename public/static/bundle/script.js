(()=>{"use strict";const t=(e,s)=>{let i=Math.floor(Math.random()*(s-e+1)+e);return 0===i&&(i=t(e,s)),i},e=t,s=()=>"#"+(1048575*Math.random()*1e6).toString(16).slice(0,6),i=class{ctx;x;y;radius;color;velocityX;velocityY;speed;velocityXMutator;velocityYMutator;mass;constructor({ctx:t,x:e,y:s,radius:i,color:o,speed:a,velocityX:c,velocityY:h,velocityXMutator:n=1,velocityYMutator:r=1,mass:l=1}){this.ctx=t,this.x=e,this.y=s,this.radius=i,this.color=o,this.velocityX=c,this.velocityY=h,this.speed=a,this.velocityXMutator=n,this.velocityYMutator=r,this.mass=l}draw(){this.ctx.beginPath(),this.ctx.arc(this.x,this.y,this.radius,0,2*Math.PI),this.ctx.fillStyle=this.color,this.ctx.shadowColor="rgba(0, 0, 0, 0.3)",this.ctx.shadowBlur=.6,this.ctx.shadowOffsetX=3,this.ctx.shadowOffsetY=3,this.ctx.fill(),this.ctx.closePath()}update(){this.x+=this.velocityX*this.speed*Math.PI/this.velocityXMutator,this.y+=this.velocityY*this.speed*Math.PI/this.velocityYMutator}};var o;!function(t){let e;!function(t){t.PARTICLEINPUT="num_particles",t.VELOCITYINPUT="num_velocity",t.SPEEDINPUT="num_speed",t.MASSINPUT="num_mass",t.RADIUSINPUT="num_radius"}(e=t.SIMCONTROLS||(t.SIMCONTROLS={})),t.SIMCONTROLS_NAME="sim_controls"}(o||(o={}));const a=o;var c;!function(t){t.INITIAL_PARTICLE_NUM=e(1,1e3),t.INITIAL_VELOCITY_DIVISOR=5,t.INITIAL_SPEED=1,t.INITIAL_MASS=1,t.INITIAL_RADIUS=10}(c||(c={}));const h=c,n=new class{MAX_PARTICLES=1e3;MIN_PARTICLES=1;MAX_ITER=1e6;root;canvas;ctx;boundary;constructor({containerId:t,width:e,height:s}){this.root=document.querySelector(`#${t}`),this.canvas=document.createElement("canvas"),this.ctx=this.canvas.getContext("2d"),e&&s&&(this.canvas.width=e,this.canvas.height=s)}initialize(){this.root&&(this.root.style.backgroundColor="white",this.root.style.borderRadius="2%",this.root.style.boxShadow="0 0 10px rgba(0, 0, 0, 0.3)",this.root.style.border="1px solid black",this.root.style.position="relative",this.root.style.width="100%",this.root.style.height="90vh",this.root.appendChild(this.canvas),window.addEventListener("resize",this.resizeCanvas.bind(this)),this.resizeCanvas()),this.boundary=new class{x;y;width;height;constructor(t,e,s,i){this.x=t,this.y=e,this.width=s,this.height=i}isCollidingWith(t){const{x:e,y:s,radius:i}=t;return e+i>this.x+this.width||e-i<this.x||s+i>this.y+this.height||s-i<this.y}resolveCollision(t){const{x:e,y:s,radius:i,velocityX:o,velocityY:a}=t;(e+i>this.x+this.width||e-i<this.x)&&(t.velocityX=-o+(.2*Math.random()-.1)),(s+i>this.y+this.height||s-i<this.y)&&(t.velocityY=-a+(.2*Math.random()-.1))}resolveCollisions(t){for(const e of t)this.isCollidingWith(e)&&this.resolveCollision(e)}}(0,0,this.canvas.width,this.canvas.height)}clearCanvas(){this.ctx?.clearRect(0,0,this.canvas.width,this.canvas.height)}resizeCanvas(){this.root&&this.ctx&&(this.canvas.width=this.root.offsetWidth,this.canvas.height=this.root.offsetHeight)}drawLine(t,e,s,i){this.ctx&&(this.ctx.moveTo(t,e),this.ctx.lineTo(s,i),this.ctx.stroke())}}({containerId:"canvas"});n.initialize();let r=h.INITIAL_VELOCITY_DIVISOR,l=h.INITIAL_SPEED,I=h.INITIAL_RADIUS,d=[];const u=new class{form;constructor(t){this.form=document.querySelector(`#${t}`)}getInputValue(t){return this.form.querySelector(`#${t}`).value}setInputValue(t,e){this.form.querySelector(`#${t}`).value=e}}(a.SIMCONTROLS_NAME),v=document.getElementById(a.SIMCONTROLS.PARTICLEINPUT),y=document.getElementById(a.SIMCONTROLS.SPEEDINPUT),S=document.getElementById(a.SIMCONTROLS.MASSINPUT),T=document.getElementById(a.SIMCONTROLS.RADIUSINPUT),N=()=>{const t=parseInt(v.value,10)||h.INITIAL_PARTICLE_NUM;t>d.length?M({particles:d,desiredNumParticles:t}):t<d.length?L({particles:d,desiredNumParticles:t}):x()},x=()=>{for(let t=0;t<d.length;t++)d[t].radius=I},M=({particles:t,desiredNumParticles:o})=>{const a=o-t.length;let c=0;for(;c<a&&c<n.MAX_ITER;){const o=new i({ctx:n.ctx,x:e(0,n.canvas.width),y:e(0,n.canvas.height),radius:I,color:s(),speed:l,velocityX:e(-2,2),velocityY:e(-2,2),velocityXMutator:r,velocityYMutator:r});t.push(o),c++}},L=({particles:t,desiredNumParticles:e})=>{const s=t.length-e;t.splice(e,s)};v.addEventListener("change",(t=>{N()})),y.addEventListener("change",(t=>{l=parseFloat(y.value)||h.INITIAL_SPEED,N()})),S.addEventListener("change",(t=>{l=parseFloat(S.value)||h.INITIAL_MASS,N()})),T.addEventListener("change",(t=>{I=parseFloat(T.value)||h.INITIAL_RADIUS,N()})),u.setInputValue(a.SIMCONTROLS.PARTICLEINPUT,h.INITIAL_PARTICLE_NUM.toString()),u.setInputValue(a.SIMCONTROLS.VELOCITYINPUT,r.toString()),u.setInputValue(a.SIMCONTROLS.SPEEDINPUT,h.INITIAL_SPEED.toString()),u.setInputValue(a.SIMCONTROLS.MASSINPUT,h.INITIAL_MASS.toString()),u.setInputValue(a.SIMCONTROLS.RADIUSINPUT,h.INITIAL_RADIUS.toString()),N();const g=document.getElementById("canvas");g.addEventListener("click",(t=>{const o=g.getBoundingClientRect(),a=t.clientX-o.left,c=t.clientY-o.top;d.push(new i({ctx:n.ctx,x:a,y:c,radius:10,color:s(),speed:l,velocityX:e(-2,2),velocityY:e(-2,2),velocityXMutator:r,velocityYMutator:r})),v.value=d.length.toString()}));const m=()=>{n.clearCanvas();for(let t=0;t<d.length;t++){const e=d[t];e.speed=l,e.draw();const s=e.x+e.velocityX,i=e.y+e.velocityY,o=s-e.radius<0||s+e.radius>n.canvas.width,a=i-e.radius<0||i+e.radius>n.canvas.height;o&&(e.velocityX*=-1,e.x+=e.velocityX),a&&(e.velocityY*=-1,e.y+=e.velocityY),e.update();for(let s=t+1;s<d.length;s++){const t=d[s],i=t.x-e.x,o=t.y-e.y,a=Math.sqrt(i*i+o*o);if(a<e.radius+t.radius){const s=i/a,c=o/a,h=(t.velocityX-e.velocityX)*s+(t.velocityY-e.velocityY)*c;if(h<0){const i=2*h/(e.mass+t.mass);e.velocityX+=i*t.mass*s,e.velocityY+=i*t.mass*c,t.velocityX-=i*e.mass*s,t.velocityY-=i*e.mass*c;const o=.5*(a-e.radius-t.radius);e.x-=o*s,e.y-=o*c,t.x+=o*s,t.y+=o*c}}}}requestAnimationFrame(m)};m()})();